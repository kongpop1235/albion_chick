<template>
  <v-card :elevation="0" class="bg_card rounded-lg position-relative">
    <div id="app" class="pa-5">
      <v-card-title class="pa-0 text-h grey--text text--lighten-1">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          x="0px"
          y="0px"
          width="32"
          height="32"
          viewBox="0 0 172 172"
          style="fill: #000000"
          class="mr-4"
        >
          <g
            fill="none"
            fill-rule="nonzero"
            stroke="none"
            stroke-width="1"
            stroke-linecap="butt"
            stroke-linejoin="miter"
            stroke-miterlimit="10"
            stroke-dasharray=""
            stroke-dashoffset="0"
            font-family="none"
            font-weight="none"
            font-size="none"
            text-anchor="none"
            style="mix-blend-mode: normal"
          >
            <path d="M0,172v-172h172v172z" fill="none"></path>
            <g id="Layer_1">
              <path
                d="M58.38594,123.625h-36.14688c-3.61469,0 -6.78594,2.40531 -7.76688,5.88563l-7.55187,26.875c-1.45125,5.14656 2.41875,10.23937 7.76688,10.23937h51.2775c5.34812,0 9.20469,-5.10625 7.76687,-10.23937l-7.55187,-26.875c-1.00781,-3.48031 -4.17906,-5.88563 -7.79375,-5.88563z"
                fill="#f1c40f"
              ></path>
              <path
                d="M149.76094,123.625h-36.14688c-3.61469,0 -6.78594,2.40531 -7.76688,5.88563l-7.55187,26.875c-1.45125,5.14656 2.41875,10.23937 7.76687,10.23937h51.2775c5.34812,0 9.20469,-5.10625 7.76687,-10.23937l-7.55188,-26.875c-1.00781,-3.48031 -4.17906,-5.88563 -7.79375,-5.88563z"
                fill="#f1c40f"
              ></path>
              <path
                d="M102.72969,59.125h-33.45937c-3.61469,0 -6.78594,2.40531 -7.76688,5.88563l-7.55187,26.875c-1.45125,5.13313 2.40531,10.23938 7.75344,10.23938h48.59c5.34812,0 9.20469,-5.10625 7.76687,-10.23938l-7.55188,-26.875c-0.99437,-3.48031 -4.16562,-5.88562 -7.78031,-5.88562z"
                fill="#f1c40f"
              ></path>
              <path
                d="M65.95125,170.65625h-51.2775c-3.81625,0 -7.33687,-1.74687 -9.63469,-4.79719c-2.31125,-3.05031 -3.03687,-6.89344 -2.00219,-10.57531l7.55187,-26.875c1.46469,-5.18688 6.24844,-8.815 11.65031,-8.815h36.16031c5.38844,0 10.18562,3.62812 11.63688,8.815l7.55187,26.875c1.03469,3.68187 0.30906,7.53844 -2.00219,10.57531c-2.29781,3.05031 -5.81844,4.79719 -9.63469,4.79719zM22.23906,127.65625c-1.80062,0 -3.39969,1.20937 -3.88344,2.94281l-7.55188,26.875c-0.34938,1.22281 -0.1075,2.51281 0.67188,3.52062c0.76594,1.02125 1.935,1.59906 3.21156,1.59906h51.2775c1.27656,0 2.44562,-0.57781 3.21156,-1.59906c0.76594,-1.02125 1.00781,-2.29781 0.67188,-3.52062l-7.56531,-26.875c-0.49719,-1.73344 -2.09625,-2.94281 -3.89687,-2.94281z"
                fill="#666666"
              ></path>
              <path
                d="M157.32625,170.65625h-51.2775c-3.81625,0 -7.33687,-1.74687 -9.63469,-4.79719c-2.31125,-3.05031 -3.03688,-6.89344 -2.00219,-10.57531l7.55188,-26.875c1.46469,-5.18688 6.24844,-8.815 11.65031,-8.815h36.16031c5.38844,0 10.18562,3.62812 11.63688,8.815l7.55187,26.875c1.03469,3.68187 0.30906,7.53844 -2.00219,10.57531c-2.29781,3.05031 -5.81844,4.79719 -9.63469,4.79719zM113.61406,127.65625c-1.80063,0 -3.39969,1.20937 -3.88344,2.94281l-7.55187,26.875c-0.34938,1.22281 -0.1075,2.51281 0.67188,3.52062c0.76594,1.02125 1.935,1.59906 3.21156,1.59906h51.2775c1.27656,0 2.44562,-0.57781 3.21156,-1.59906c0.76594,-1.02125 1.00781,-2.29781 0.67188,-3.52062l-7.56531,-26.875c-0.48375,-1.73344 -2.08281,-2.94281 -3.88344,-2.94281z"
                fill="#666666"
              ></path>
              <path
                d="M110.295,106.15625h-48.59c-3.81625,0 -7.33688,-1.74688 -9.63469,-4.79719c-2.31125,-3.05031 -3.03687,-6.89344 -2.00219,-10.57531l7.55187,-26.875c1.46469,-5.18688 6.24844,-8.815 11.65031,-8.815h33.47281c5.38844,0 10.18563,3.62813 11.63687,8.815l7.55188,26.875c1.03469,3.68188 0.30906,7.53844 -2.00219,10.57531c-2.29781,3.05031 -5.81844,4.79719 -9.63469,4.79719zM69.27031,63.15625c-1.80063,0 -3.39969,1.20937 -3.88344,2.94281l-7.55187,26.875c-0.34938,1.22281 -0.1075,2.51281 0.67188,3.52062c0.7525,1.02125 1.92156,1.59906 3.19813,1.59906h48.59c1.27656,0 2.44562,-0.57781 3.21156,-1.59906c0.76594,-1.02125 1.00781,-2.29781 0.67188,-3.52062l-7.56531,-26.875c-0.48375,-1.73344 -2.08281,-2.94281 -3.88344,-2.94281z"
                fill="#666666"
              ></path>
              <path
                d="M12.38938,36.13344l16.125,9.68844c1.90813,1.14219 4.38062,0.52406 5.53625,-1.38406c1.14219,-1.90812 0.52406,-4.38062 -1.38406,-5.53625l-16.125,-9.68844c-1.90812,-1.14219 -4.38062,-0.52406 -5.53625,1.38406c-1.14219,1.90813 -0.52406,4.38062 1.38406,5.53625z"
                fill="#f1c40f"
              ></path>
              <path
                d="M1.34375,71.21875c0,2.23062 1.80062,4.03125 4.03125,4.03125h16.125c1.46469,0 2.75469,-0.77938 3.45344,-1.96188c0.36281,-0.60469 0.57781,-1.31687 0.57781,-2.06937c0,-2.23062 -1.80062,-4.03125 -4.03125,-4.03125h-16.125c-2.23063,0 -4.03125,1.80063 -4.03125,4.03125z"
                fill="#f1c40f"
              ></path>
              <path
                d="M53.69625,24.34875c0.67188,-0.34938 1.19594,-0.87344 1.55875,-1.47813c0.69875,-1.16906 0.79281,-2.67406 0.1075,-3.9775l-7.56531,-14.24375c-1.04813,-1.96188 -3.48031,-2.71438 -5.45562,-1.66625c-1.96188,1.04813 -2.71438,3.48031 -1.66625,5.45562l7.56531,14.24375c1.04812,1.96188 3.48031,2.71438 5.45562,1.66625z"
                fill="#f1c40f"
              ></path>
              <g fill="#f1c40f">
                <path
                  d="M159.61063,36.26781l-16.00406,9.60781c-1.51844,0.91375 -3.52062,0.87344 -4.8375,-0.30906c-2.15,-1.935 -1.70656,-5.16 0.55094,-6.51719l16.00406,-9.60781c1.51844,-0.91375 3.52063,-0.87344 4.8375,0.30906c2.16344,1.92156 1.72,5.16 -0.55094,6.51719z"
                ></path>
                <path
                  d="M170.45469,72.49531c-0.52406,1.69313 -2.21719,2.75469 -3.9775,2.75469h-15.97719c-1.46469,0 -2.75469,-0.77938 -3.45344,-1.96188c-0.41656,-0.68531 -0.63156,-1.505 -0.56438,-2.365c0.14781,-2.15 2.10969,-3.73562 4.27312,-3.73562h15.86969c2.63375,0 4.68969,2.53969 3.82969,5.30781z"
                ></path>
                <path
                  d="M118.5725,24.6175c-0.79281,-0.34938 -1.41094,-0.92719 -1.8275,-1.6125c-0.69875,-1.16906 -0.79281,-2.67406 -0.1075,-3.9775l7.44438,-14.00187c1.03469,-1.94844 3.42656,-2.92938 5.41531,-1.97531c2.08281,0.99438 2.9025,3.52063 1.8275,5.53625l-7.45781,14.01531c-1.00781,1.90812 -3.31906,2.88906 -5.29438,2.01563z"
                ></path>
              </g>
            </g>
          </g>
        </svg>
        <p class="mt-auto mb-0 d-inline">Gold price</p>
        <v-spacer></v-spacer>
        <p class="mt-auto mb-0 d-inline mr-4">{{ day }}</p>
        <p class="mt-auto mb-0 d-inline">{{ montsh }}</p>
      </v-card-title>
      <br />
      <div>
        <canvas id="gold" class="c-gold"></canvas>
      </div>
    </div>
  </v-card>
</template>

<script>
import Chart from "chart.js/auto";

export default {
  name: "gold",
  components: {},
  data() {
    return {
      day: null,
      montsh: null,
      year: null,
    };
  },
  async mounted() {

    const d = new Date();
    // const y = new Date(Date.now() - 864e5); // 864e5 == 86400000 == 24*60*60*1000 yesterday easy day
    const months = [
      "Jan.",
      "Feb.",
      "Mar.",
      "Apr.",
      "May",
      "Jun.",
      "Jul.",
      "Aug.",
      "Sep.",
      "Oct.",
      "Nov.",
      "Dec.",
    ];

    let month = months[d.getMonth()];
    this.montsh = month;
    this.day = d.getDate();

    let gold = [];
    let time = [];

    const wait = (
      timeToDelay //delay
    ) => new Promise((resolve) => setTimeout(resolve, timeToDelay));
    //log
    await wait(1); //delay time

    if (this.$store.getters.gold_price[1] == true) {
      //check Gold data
      /* console.log("+++++++++++++++++++");
      console.log(this.$store.getters.gold_price[0]);
      console.log("+++++++++++++++++++"); */

      for (let x = 0; x < 24; x++) {
        gold.push(this.$store.getters.gold_price[0][x].price);
        time.push(this.$store.getters.gold_price[0][x].timestamp.substring(11, 16));
      }
    }

    var ctx = document.getElementById("gold").getContext("2d");
    var myChart = new Chart(ctx, {
      type: "bar",
      data: {
        labels: time,
        datasets: [
          {
            label: "gold value ",
            data: gold,
            backgroundColor: ["rgba(255, 159, 64, 0.8)"],
            borderRadius: Number.MAX_VALUE,
          },
        ],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false, //label : ปิด
          },
        },
        scales: {
          y: {
            max: Math.max(...gold) + 10,
            min: Math.min(...gold) - 10,
            beginAtZero: true,
            ticks: {
              color: "#bdbdbd",
            },
            grid: {
              color: "rgba(255, 255, 255, 0.3)",
              borderColor: "rgba(255, 99, 132, 0)",
              borderDash: [10],
              tickLength: 20,
              tickColor: false,
            },
          },
          x: {
            ticks: {
              color: "#bdbdbd",
            },
            grid: {
              color: false,
              borderColor: "rgba(255, 99, 132, 0)",
            },
          },
        },
      },
    });
    console.log("gold1 : ");
    console.log(myChart);
    console.log("gold2 : ");
    console.log(ctx);
  },
};
</script>

<style scoped>
.c-gold {
  height: 210px;
}
</style>
